<!DOCTYPE html>
<html>
<head>
<title>Connexion</title>

<style>
body{text-align:center;font-family:Arial;margin-top:100px}
input{padding:10px;margin:10px}
button{padding:10px}
</style>

</head>

<body>

<h2>Connexion Utilisateur</h2>

<input id="user" placeholder="Utilisateur"><br>
<input id="pass" type="password" placeholder="Mot de passe"><br>

<button onclick="login()">Se connecter</button>

<p id="msg"></p>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

<script>

const client = mqtt.connect('wss://test.mosquitto.org:8081/mqtt');

function login(){

  let u = document.getElementById("user").value;
  let p = document.getElementById("pass").value;

  client.publish("maison/login", u+":"+p);
}

client.on('connect', function(){
  client.subscribe("maison/login/reponse");
});

client.on('message', function(topic,message){

  if(topic=="maison/login/reponse"){

    if(message.toString()=="OK"){
      window.location="commande.html";
    } else {
      document.getElementById("msg").innerHTML="Identifiants incorrects";
    }
  }

});

</script>

</body>
</html>
